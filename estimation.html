<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estimation - ORPI Immobilier Paris</title>
    <link rel="icon" type="image/png" href="images.png">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="js/cache-buster.js"></script>
</head>
<body>
    <div id="pageLoader" class="page-loader">
        <div class="loader-content">
            <div class="loader-spinner"></div>
            <div class="loader-text">ORPI</div>
        </div>
    </div>

        <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="images/logo-orpi-mandelieu.png" alt="ORPI Logo">
                <span>ORPI Paris</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">Accueil</a>
                </li>
                <li class="nav-item">
                    <a href="biens.html" class="nav-link">Nos Biens</a>
                </li>
                <li class="nav-item">
                    <a href="interieurs.html" class="nav-link">Intérieurs</a>
                </li>
                <li class="nav-item">
                    <a href="contact.html" class="nav-link">Contact</a>
                </li>
                <li class="nav-item">
                    <a href="estimation.html" class="nav-link active">Estimation</a>
                </li>
                <li class="nav-item">
                    <a href="rendez-vous.html" class="nav-link">
                        <i class="fas fa-calendar-alt"></i> Rendez-vous
                    </a>
                </li>
                <li class="nav-item">
                    <a href="avis.html" class="nav-link">
                        <i class="fas fa-star"></i> Avis
                    </a>
                </li>
                <li class="nav-item" id="adminPanel" style="display: none;">
                    <a href="admin.html" class="nav-link admin-link">
                        <i class="fas fa-shield-alt"></i> Panel Administration
                    </a>
                </li>
            </ul>
            <span class="notifications-text" id="notificationsText" style="display: none;"></span>
            <div class="notifications-btn" id="notificationsBtn" style="display: none;" onclick="toggleNotifications()">
                <i class="fas fa-bell"></i>
                <span class="notifications-badge" id="notificationsBadge" style="display: none;">0</span>
            </div>
            <div class="user-profile" id="userProfile" style="display: none;">
                <img id="userAvatar" src="" alt="Avatar" class="user-avatar">
                <span id="userName" class="user-name"></span>
                <button onclick="logout()" class="logout-btn" title="Déconnexion">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
            <button id="loginBtn" class="discord-login-btn" onclick="loginWithDiscord()">
                <i class="fab fa-discord"></i> Connexion
            </button>
        </div>
    </nav>

        <section class="estimation-section">
        <div class="container">
            <div class="estimation-header">
                <h1>Estimation de votre bien</h1>
                <p>Renseignez vos informations pour être recontacté par notre équipe d'experts.</p>
            </div>

            <div class="estimation-content">
                <div id="loginRequired" style="display: none; background: #fff3cd; padding: 2rem; border-radius: 10px; border-left: 4px solid #ffc107; margin-bottom: 2rem;">
                    <h3 style="color: #856404; margin-bottom: 1rem;">
                        <i class="fas fa-lock"></i> Connexion requise
                    </h3>
                    <p style="margin-bottom: 1.5rem;">Vous devez vous connecter avec Discord pour demander une estimation.</p>
                    <button type="button" onclick="loginWithDiscord()" style="padding: 0.75rem 1.5rem; background: #5865F2; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        <i class="fab fa-discord"></i> Se connecter avec Discord
                    </button>
                </div>
                
                <form id="estimationForm" class="estimation-form" style="display: none;">
                    <div class="form-section">
                        <h3>Vos informations</h3>
                        <div style="background: #e8f5e9; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid #4caf50;">
                            <i class="fas fa-user-check"></i> <strong>Connecté en tant que :</strong> <span id="connectedUser"></span>
                        </div>

                        <div class="form-group">
                            <label for="phone">Numéro de téléphone *</label>
                            <input type="tel" id="phone" name="phone" placeholder="06 12 34 56 78" required>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Informations du bien</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="propertyType">Type de bien *</label>
                                <select id="propertyType" name="propertyType" required>
                                    <option value="">Sélectionnez un type</option>
                                    <option value="Maison">Maison</option>
                                    <option value="Appartement">Appartement</option>
                                    <option value="Villa">Villa</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="location">Localisation *</label>
                                <input type="text" id="location" name="location" placeholder="Ville, code postal..." required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="rooms">Nombre de pièces *</label>
                                <input type="number" id="rooms" name="rooms" min="1" required>
                            </div>

                            <div class="form-group">
                                <label for="area">Surface estimée (m²) *</label>
                                <input type="number" id="area" name="area" min="1" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="purchasePrice">Prix d'achat (€) *</label>
                            <input type="number" id="purchasePrice" name="purchasePrice" min="0" required>
                        </div>

                        <div class="form-group">
                            <label for="additionalInfo">Informations complémentaires</label>
                            <textarea id="additionalInfo" name="additionalInfo" rows="4" placeholder="Travaux réalisés, état général, équipements..."></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Photos du bien</h3>
                        <p class="form-hint">Ajoutez jusqu'à 2 photos de votre bien pour une estimation plus précise</p>
                        
                        <div class="form-group">
                            <div id="dropZoneEstimation" class="drop-zone">
                                <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
                                <p style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">Glissez-déposez vos images ici</p>
                                <p style="font-size: 0.9rem; color: #666; margin-bottom: 1rem;">ou</p>
                                <button type="button" class="btn-select-files" onclick="document.getElementById('photos').click()">
                                    <i class="fas fa-folder-open"></i> Parcourir les fichiers
                                </button>
                                <input type="file" id="photos" name="photos" accept="image/*" multiple style="display: none;">
                                <p style="font-size: 0.85rem; color: #999; margin-top: 1rem;">
                                    <i class="fas fa-info-circle"></i> Maximum 2 images (JPG, PNG, WebP)
                                </p>
                            </div>
                            <div id="photosPreview" class="images-preview-container"></div>
                        </div>
                    </div>

                    <button type="submit" class="btn-submit">
                        <span class="btn-text">Demander une estimation</span>
                        <span class="btn-loader" style="display: none;">
                            <svg class="spinner" viewBox="0 0 50 50">
                                <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
                            </svg>
                        </span>
                    </button>
                </form>

                <div id="formMessage" class="form-message" style="display: none;"></div>
            </div>
        </div>
    </section>

        <div id="notificationsModal" class="modal">
        <div class="modal-content notifications-modal">
            <div class="modal-header">
                <h2>Notifications</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="notifications-actions">
                <button id="markAllReadBtn" class="btn-secondary">Tout marquer comme lu</button>
            </div>
            <div id="notificationsList" class="notifications-list">
                <div class="loading">Chargement...</div>
            </div>
        </div>
    </div>

        <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/firebase-theme.js"></script>
    <script src="js/firebase-conversations.js"></script>
    
        <script src="js/config.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/auth.js"></script>
    
        <script src="js/webhook-config.js"></script>
    
        <script src="js/script.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/estimation.js"></script>
</body>
</html>

